import{r as o,a as l,j as e,F as m,b as Ue}from"./index.5791bf1f.js";import{c as g,R as De,g as Z,a as ze}from"./globalVars.97df2e75.js";import{P as ee,C as te,a as U}from"./spine.729886ec.js";import{n as C}from"./noImage.644fcd52.js";import{D as Ee,L as Me}from"./LoaderButton.83bc68f8.js";function Oe({title:a,titleId:c,...d},p){return l("svg",{...Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:p,"aria-labelledby":c},d),children:[a?e("title",{id:c,children:a}):null,e("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.28 7.22a.75.75 0 00-1.06 1.06L8.94 10l-1.72 1.72a.75.75 0 101.06 1.06L10 11.06l1.72 1.72a.75.75 0 101.06-1.06L11.06 10l1.72-1.72a.75.75 0 00-1.06-1.06L10 8.94 8.28 7.22z",clipRule:"evenodd"})]})}const Ae=o.exports.forwardRef(Oe),Ve=Ae;function Fe({bookId:a,image:c,setDisplayImage:d,displayImage:p}){return e(m,{children:p?e("div",{className:"absolute top-0 left-0 flex items-center justify-center w-screen h-screen m-0 backdrop-blur-sm bg-black/80 z-60",children:l("div",{className:"relative",children:[e(Ve,{onClick:()=>{d(!1)},className:"absolute z-40 h-12 text-black bg-white rounded-full cursor-pointer top-4 right-4"}),e("img",{className:"max-h-screen pointer-events-none max-w-screen",src:g(a,c)})]})}):e(m,{})})}function _e(a){const c=new De(Z.pocketbaseDomain),[d,p]=o.exports.useState(),[b,D]=o.exports.useState(),[i,S]=o.exports.useState([]),[I,L]=o.exports.useState(!1),[ae,ne]=o.exports.useState(),[se,oe]=o.exports.useState(),[f,z]=o.exports.useState([]),E=o.exports.useRef(null),x=o.exports.useRef(null),w=o.exports.useRef(null),[le,H]=o.exports.useState(""),[re,j]=o.exports.useState(""),[M,ie]=o.exports.useState(a.data.name),[O,ce]=o.exports.useState(a.data.author),[A,de]=o.exports.useState(a.data.publisher),[V,F]=o.exports.useState("1900-12-12"),[T,me]=o.exports.useState(a.data.description),[u,v]=o.exports.useState(a.data.borrowedBy),[he,ue]=o.exports.useState([]),[ge,k]=o.exports.useState(-2),[G,B]=o.exports.useState(1),[W,q]=o.exports.useState(1),[P,$]=o.exports.useState([]),[pe,N]=o.exports.useState(!1),[xe,X]=o.exports.useState(!1),[be,_]=o.exports.useState(!1),[we,J]=o.exports.useState(!1),K=o.exports.useRef(!1),y=o.exports.useRef(null),[Q,R]=o.exports.useState(6);c.authStore.isValid||(window.location.href="/signin"),o.exports.useEffect(()=>{if(d!=null){const t=URL.createObjectURL(d);return ne(t),()=>URL.revokeObjectURL(t)}},[d]),o.exports.useEffect(()=>{if(b!=null){const t=URL.createObjectURL(b);return oe(t),()=>URL.revokeObjectURL(t)}},[b]),o.exports.useEffect(()=>{if(i.length!=f.length){let t=[];for(let n=0;n<i.length;n++){const s=URL.createObjectURL(i[n]);t.push(s)}z(t)}else if(i[i.length-1]!=null){const t=URL.createObjectURL(i[i.length-1]);return z([...f,t]),()=>URL.revokeObjectURL(t)}},[i]),o.exports.useEffect(()=>{K.current||(K.current=!0,ye())},[]),o.exports.useEffect(()=>{Be(G,a.data.id)},[G]);const fe=async()=>{const t=await c.collection("users").getOne(c.authStore.model.id,{});switch(t.hasSub||(window.location.href=Z.homepageDomain+"/pricing"),t.subscriptionPlan){case 3:R(13);break;case 2:R(10);break;default:R(6);break}};o.exports.useEffect(()=>{fe()},[]);async function ve(t){let n=await fetch(t).then(s=>s.blob());D(n)}async function ke(t){let n=await fetch(t).then(s=>s.blob());p(n)}async function Ne(t,n){if(n>=0&&i.length==0)for(var s=0;s<=n;s++){let r=await fetch(g(a.data.id,t[s])).then(h=>h.blob());S(h=>[...h,r])}}function ye(){!a.data.publishDate==""&&F(a.data.publishDate.split(" ")[0]),a.data.coverImage!=""&&ve(g(a.data.id,a.data.coverImage)),a.data.spineImage!=""&&ke(g(a.data.id,a.data.spineImage)),Ne(a.data.otherImages,a.data.otherImages.length-1)}async function Ce(){const t={name:M,author:O,publisher:A,publishDate:V,description:T,user:c.authStore.model.id,borrowedBy:u,otherImages:null};_(!0);const n=new FormData;n.append("spineImage",d),n.append("coverImage",b),i.forEach(s=>{n.append("otherImages",s,-1)}),Se(t,n).then(()=>{window.location.reload(!1)})}const Se=async(t,n)=>{console.log(n);try{const s=await c.collection("book").update(a.data.id,t),r=await c.collection("book").update(a.data.id,n)}catch{_(!1)}},Ie=t=>{S([...i.slice(0,t),...i.slice(t+1)])},Le=t=>{new U(t,{quality:.6,success:n=>{p(n)}})},He=t=>{new U(t,{quality:.6,success:n=>{D(n)}})};function je(t){let n=[];for(let s=0;s<t.length;s++){let r=t[s],h=new Promise((Pe,Te)=>{new U(r,{quality:.6,success:Re=>{Pe(Re)}})});n.push(h)}Promise.all(n).then(s=>{let r=Q-i.length;s=s.slice(0,r);let h=0;s.length==0&&(h=1),i.length+s.length+h<=Q&&S(i.concat(s))})}const Y=async t=>{try{const s=await c.collection("book").getList(1,4,{filter:`borrowedBy ~ "${t}"`});var n=[];s.items.map(r=>{n.push(r.borrowedBy)}),ue([...new Set(n)])}catch{}},Be=async(t,n)=>{if(!(t>W)){try{const s=await c.collection("collection").getList(t,2,{filter:`books ~ "${n}"`,expand:"books"});s.totalPages>0&&q(s.totalPages),t===1?(B(1),$(s.items)):$(P.concat(s.items))}catch{}W<=0&&q(1)}};return o.exports.useEffect(()=>{const t=new IntersectionObserver(n=>{n.forEach(s=>{s.isIntersecting&&B(r=>r+1)})},{rootMargin:"0px 0px 0px 0px",threshold:0});return B(1),y.current&&t.observe(y.current),()=>{t.disconnect()}},[y]),e(Ue,{overlay:l(m,{children:[xe?e("div",{className:"bg-black/40 absolute bottom-0 left-0 z-50 grid items-center justify-center w-screen h-screen transition",children:l("div",{className:"bg-wood-side-dark darker px-4 py-2 text-white rounded-lg",style:{boxShadow:"0px 0px 1px 4px rgba(255, 0, 0, 0.4)"},children:[e("h2",{className:"text-xl font-semibold",children:"Are you sure?"}),e("p",{className:"font-light",children:"This will delete this book forever!"}),l("div",{className:"flex justify-end gap-4 mt-2",children:[e("button",{onClick:()=>X(!1),className:"secondary-button",children:"Cancel"}),e(Ee,{submitted:we,onClick:async()=>{J(!0);try{await c.collection("book").delete(a.data.id)}catch{J(!1)}window.location.href="/",window.location.reload(!0)},children:"Delete"})]})]})}):e(m,{}),e(Fe,{image:le,bookId:re,displayImage:pe,setDisplayImage:N})]}),topbar:l("div",{className:"bg-black/40 border-b-white/20 backdrop-blur-md sticky top-0 left-0 z-50 flex justify-between px-4 py-2 text-2xl font-medium text-white border-b-2",children:[l("h1",{onClick:()=>a.backFunction(!1),className:"whitespace-nowrap flex gap-2 my-auto overflow-hidden cursor-pointer",children:[e("div",{className:"w-9 h-9",children:e("svg",{className:"w-9 h-9",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5L8.25 12l7.5-7.5"})})}),e("span",{children:a.data.name})]}),l("a",{onClick:()=>{L(!I)},className:"flex gap-2 cursor-pointer",children:[e("h2",{className:"pl-4 my-auto text-2xl font-light text-center pointer-events-none",children:I?"Cancel":"Edit"}),e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1,stroke:"currentColor",className:"w-6 h-6 my-auto",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125"})})]})]}),children:I?l("div",{className:"px-4",children:[e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Book Title"}),e("input",{maxLength:100,type:"text",className:"input-text",value:M,onChange:t=>ie(t.target.value)}),e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Book Author"}),e("input",{maxLength:100,className:"input-text",type:"text",value:O,onChange:t=>ce(t.target.value)}),e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Book Publisher"}),e("input",{maxLength:100,className:"input-text",type:"text",value:A,onChange:t=>de(t.target.value)}),e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Date Published"}),e("input",{className:"input-text",type:"date",value:V,onChange:t=>F(t.target.value)}),e("h2",{className:"py-2 pr-4 text-lg font-light text-white",children:"Description"}),e("textarea",{maxLength:5e3,rows:"18",type:"text",className:"input-text",placeholder:"",value:T,onChange:t=>me(t.target.value)}),l("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:["Book Borrower ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),l("div",{className:"bg-black/40 backdrop-blur-sm px-2 py-2 rounded-lg shadow-inner",children:[l("div",{className:"relative",children:[e("input",{maxLength:128,className:"input-text",type:"text",value:u,onChange:t=>{v(t.target.value),Y(t.target.value),k(-2)}}),e("svg",{onClick:()=>{v(""),Y(""),k(-2)},xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8.5 h-8.5 absolute top-1 right-1",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),u!=""?e(m,{children:he.map((t,n)=>e("div",{id:n.toString(),children:ge==n?t==u?null:l("div",{className:"backdrop-blur-sm bg-white/5 text-md backdrop-brightness-110 border-white/80 flex w-full gap-1 px-1 py-1 mt-2 text-white border rounded-lg shadow-xl cursor-pointer",onClick:()=>{v(""),k(-2)},children:[e(ee,{className:"h-6 pointer-events-none"}),e("p",{className:"my-auto pointer-events-none select-none",children:t})]}):t==u?null:l("div",{id:n.toString(),className:"backdrop-blur-sm bg-white/5 border-white/20 text-md flex w-full gap-1 px-1 py-1 mt-2 text-white border rounded-lg shadow-xl cursor-pointer",onClick:()=>{v(t),k(n)},children:[e(ee,{className:"h-6 pointer-events-none"}),e("p",{className:"my-auto pointer-events-none select-none",children:t})]},n.toString())},n.toString()))}):null]}),e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Main Images"}),l("div",{className:"input-text flex gap-2 px-2 py-2 text-white",children:[l("div",{className:"max-h-fit flex-1",children:[d?e("button",{className:"inner-shadow-main bg-white/0 border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white border-2 rounded-lg shadow-inner",onClick:()=>w.current.click(),children:"Change Spine Image"}):e("button",{className:"inner-shadow-main bg-white/0 border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white border-2 rounded-lg shadow-inner",onClick:()=>w.current.click(),children:"Add Spine Image"}),e("input",{type:"file",id:"spineImage",className:"hidden",ref:w,accept:"image/jpg, image/jpeg, image/png, image/svg+xml, image/gif, image/webp",onChange:t=>{Le(t.target.files[0])}}),d?e("img",{className:"max-h-60 max-w-full mx-auto my-auto rounded-md",onClick:()=>w.current.click(),src:ae}):e("img",{className:"opacity-20 max-h-60 max-w-full mx-auto my-auto rounded-md",onClick:()=>w.current.click(),src:te})]}),l("div",{className:"flex-1",children:[x?e("button",{className:"inner-shadow-main bg-white/0 border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white border-2 rounded-lg shadow-inner",onClick:()=>x.current.click(),children:"Change Cover Image"}):e("button",{className:"inner-shadow-main bg-white/0 border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white border-2 rounded-lg shadow-inner",onClick:()=>x.current.click(),children:"Add Cover Image"}),e("input",{type:"file",id:"coverImage",className:"hidden",ref:x,accept:"image/jpg, image/jpeg, image/png, image/svg+xml, image/gif, image/webp",onChange:t=>{He(t.target.files[0])}}),b?e("img",{onClick:()=>x.current.click(),className:"max-h-60 max-w-full mx-auto my-auto rounded-md",src:se}):e("img",{onClick:()=>x.current.click(),className:"opacity-20 max-h-60 max-w-full mx-auto my-auto rounded-md",src:te})]})]}),e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Other Images"}),l("div",{className:"input-text flex flex-wrap gap-4 px-4 py-2 text-white rounded-lg",children:[e("img",{alt:"Add another image",className:"image h-32 pointer-events-auto",src:"../images/plus.svg",onClick:()=>E.current.click()}),e("input",{type:"file",className:"hidden",ref:E,accept:"image/jpg, image/jpeg, image/png, image/svg+xml, image/gif, image/webp",name:"file",onChange:t=>{je(t.target.files)},multiple:!0}),f&&f.map((t,n)=>l("div",{className:"image-div",id:n.toString(),children:[e("img",{className:"max-h-32 image outline outline-white rounded-lg opacity-50",src:t}),e("div",{onClick:()=>Ie(n),className:"hidden_img",children:e("svg",{className:"mx-auto my-auto text-xl font-bold text-white",xmlns:"http://www.w3.org/2000/svg",width:"72",height:"72",viewBox:"-6 6 24 24",strokeWidth:"1",stroke:"#000000",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e("path",{stroke:"currentColor",d:"M10 10l4 4m0 -4l-4 4"})})})]},n.toString()))]}),l("div",{className:"flex justify-between pt-4",children:[e("a",{className:"warning-button cursor-pointer select-none",onClick:()=>{X(!0)},children:"Delete"}),l("div",{className:"flex justify-end",children:[e("a",{onClick:()=>L(!1),className:"secondary-button mr-4 cursor-pointer select-none",children:"Cancel"}),e(Me,{onClick:Ce,submitted:be,children:"Submit"})]})]})]}):l(m,{children:[l("div",{className:"justify-right snap-mandatory snap-x z-10 flex items-baseline gap-4 mb-4 overflow-x-scroll",children:[e("div",{className:"min-w-max z-50 text-transparent select-none",children:"AGHHHHHHHHHHHH!!! SAVE ME!!!!!"}),e("div",{className:"snap-center min-w-max z-20",onClick:a.data.coverImage?()=>{H(a.data.coverImage),j(a.data.id),N(!0)}:null,children:e("img",{className:"shadow-black h-64 rounded-md shadow-2xl cursor-pointer",src:a.data.coverImage?g(a.data.id,a.data.coverImage):a.data.spineImage?null:C})}),a.data.spineImage?e("div",{className:"snap-center min-w-max z-20",onClick:a.data.spineImage?()=>{H(a.data.spineImage),j(a.data.id),N(!0)}:null,children:e("img",{className:"shadow-black h-64 rounded-md shadow-2xl cursor-pointer",src:a.data.spineImage?g(a.data.id,a.data.spineImage):a.data.coverImage?null:C})}):null,a.data.otherImages.map((t,n)=>e("div",{id:n.toString(),className:"snap-center min-w-max z-20",onClick:t?()=>{H(t),j(a.data.id),N(!0)}:null,children:e("img",{className:"shadow-black h-64 rounded-md shadow-2xl cursor-pointer",src:t?g(a.data.id,t):C})},n.toString())),e("div",{className:"min-w-max z-50 text-transparent select-none",children:"AGHHHHHHHHHHHH!!! SAVE ME!!!!!"})]}),l("div",{className:"bg-black/40 drop-shadow-strong px-4 pb-16",children:[l("h2",{className:"text-3xl text-white",children:[a.data.name?a.data.name:e("span",{className:"text-gray-100",children:"Unknown Title"}),l("span",{className:"font-light text-gray-300",children:[" (",a.data.publishDate.split(" ")[0].split("-")[0],")"]})]}),l("h2",{className:"text-2xl font-light text-white",children:["Author: ",a.data.author?a.data.author:e(m,{children:"Unknown"})]}),l("h2",{className:"text-md pt-2 font-light text-gray-300",children:["Published in ",a.data.publishDate.split(" ")[0].split("-")[2],"/",a.data.publishDate.split(" ")[0].split("-")[1],"/",a.data.publishDate.split(" ")[0].split("-")[0]]}),l("h2",{className:"text-md font-light text-gray-300",children:["by ",a.data.publisher?a.data.publisher:e(m,{children:"Unknown"})]}),u?e("div",{className:"border-t-white pt-4 mt-4 border-t",children:l("h2",{className:"text-xl",children:["Borrowed By: ",u]})}):e(m,{}),e("p",{className:"text-md border-t-white pt-4 mt-4 font-light text-white border-t shadow-md",children:a.data.description}),P.length==0?e("p",{className:"bg-black/40 backdrop-blur-sm inner-shadow-main w-full py-4 mt-8 text-center text-white rounded-lg",children:"This book is not in any collections"}):e(m,{})]}),P.map((t,n)=>l("div",{onClick:()=>{setCollectionData(t),setCollectionMenu(!0)},className:" flex flex-col -mt-12 cursor-pointer",style:{minHeight:120},id:n.toString(),children:[l("div",{className:"justify-right snap-mandatory snap-x z-10 flex items-baseline gap-4 mb-4 overflow-x-scroll",children:[e("div",{className:"min-w-max z-50 text-transparent select-none",children:"AGHHHHH!!! SAVE ME!!!!!"}),t.expand.books?t.expand.books.map((s,r)=>e("div",{id:r.toString(),className:"snap-center min-w-max z-50",children:s.coverImage?e("img",{id:r.toString(),alt:"Book cover image",className:"h-28 z-60 touch shadow-book my-4 rounded-md cursor-pointer pointer-events-none",src:ze(s.id,s.coverImage)},r.toString()):e("img",{id:r.toString(),alt:"No book cover image",className:"h-28 z-60 touch shadow-book my-4 rounded-md cursor-pointer pointer-events-none",src:C},r.toString())},r.toString())):null,e("div",{className:"min-w-max z-50 text-transparent select-none",children:"AGHHHHH!!! SAVE ME!!!!!"})]}),t.expand.books?e("div",{className:"shelf pl-4 text-xl text-white",children:e("p",{className:"bottom-4 text-shadow left-2 absolute select-none",children:t.name?t.name:"No name"})}):e("div",{className:"shelf mt-36 pl-4 text-xl text-white",children:e("p",{className:"bottom-4 text-shadow left-2 absolute select-none",children:t.name?t.name:"No name"})})]},n.toString())),e("div",{ref:y})]})})}export{_e as default};
