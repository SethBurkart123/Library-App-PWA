import{R as q,g as u}from"./globalVars.97df2e75.js";import{r as l,a,j as e,b as G,F as i}from"./index.5791bf1f.js";import{L as N}from"./LoaderButton.83bc68f8.js";import H from"./installPrompt.36576cb2.js";function J({title:s,titleId:r,...n},d){return a("svg",{...Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",ref:d,"aria-labelledby":r},n),children:[s?e("title",{id:r,children:s}):null,e("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})]})}const K=l.exports.forwardRef(J),Q=K;function X({title:s,titleId:r,...n},d){return a("svg",{...Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true",ref:d,"aria-labelledby":r},n),children:[s?e("title",{id:r,children:s}):null,e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})]})}const Y=l.exports.forwardRef(X),Z=Y;function se(){const s=new q(u.pocketbaseDomain),[r,n]=l.exports.useState(!1),[d,y]=l.exports.useState(!1),[C,f]=l.exports.useState(!1),[v,$]=l.exports.useState(!1),[x,S]=l.exports.useState(""),[p,P]=l.exports.useState(""),[k,E]=l.exports.useState(""),[m,R]=l.exports.useState(""),[w,L]=l.exports.useState(""),[h,j]=l.exports.useState(0),[U,c]=l.exports.useState(!1),[I,g]=l.exports.useState(!1),[F,M]=l.exports.useState(0),[b,o]=l.exports.useState(!1),T=async()=>{try{s.authStore.isValid||(window.location.href="/signin");const t=await s.collection("users").getOne(s.authStore.model.id,{});t.createdSubscription||(t.hasSub?window.location.href="/payment-redirect?paymentPlan="+t.subscriptionPlan:window.location.href=u.homepageDomain+"/pricing"),S(t.username),P(t.email),j(30-(Date.now()/1e3-t.datePaid)/(60*60*24)),M(t.monthlySubCost/1e5)}catch(t){t.toString().toLowerCase().includes("404")&&(s.authStore.clear(),window.location.href="/signin")}};async function W(){return await s.collection("users").update(s.authStore.model.id,{updateCustomerPortalURL:!0}),await fetch(`${u.pocketbaseDomain}/api/updateCustomerPortalURL`),(await s.collection("users").getOne(s.authStore.model.id,{})).customerPortalURL}function D(){f(!1),E(""),R(""),L(""),c(!1),g(!1)}const z=async()=>{if(o(!0),U)return o(!1),"Passwords do not match";try{const t={password:m,passwordConfirm:w,oldPassword:k},O=await s.collection("users").update(s.authStore.model.id,t);if(p&&m)try{B(p,m)}catch{o(!1)}o(!1)}catch{g(!0),o(!1)}};async function B(t,O){try{await s.collection("users").authWithPassword(t,O),D()}catch{setLoginError(!0)}}const V=async()=>{try{o(!0);const t={username:x};await s.collection("users").update(s.authStore.model.id,t),o(!1)}catch{o(!1)}},A=async()=>{await s.collection("users").update(s.authStore.model.id,{subCancelIntent:!0}),await fetch(`${u.pocketbaseDomain}/api/cancelSubscription`)};return l.exports.useEffect(()=>{T()},[]),a(G,{overlay:e(H,{hideInstallPrompt:!0}),topbar:a("h1",{className:"border-b-white/20 inner-shadow-main bg-black/40 backdrop-blur-md flex flex-1 gap-2 px-4 pt-2 pb-2 text-2xl font-bold text-white border-b-2",children:[e(Z,{className:"h-6 my-auto"}),"Settings"]}),children:[a("div",{className:"px-4",children:[a("div",{className:"flex mb-8",children:[e("p",{className:"text-gray-200/70 flex-1 text-lg font-medium",children:r?e(i,{children:"Edit Name"}):a(i,{children:["Name",e("a",{onClick:()=>n(!0),className:"text-white/70 pl-2 font-light cursor-pointer",children:"(edit)"})]})}),r?a("div",{className:"flex-1",children:[e("input",{placeholder:"Username",autoComplete:"username",type:"text",className:"input-text",value:x,onChange:t=>S(t.target.value)}),a("div",{className:"flex gap-4 pt-4",children:[e("a",{onClick:()=>{n(!1)},className:"secondary-button ml-auto cursor-pointer",children:"Cancel"}),e(N,{type:"submit",onClick:()=>{n(!1),V()},submitted:b,children:"Submit"})]})]}):e("p",{className:"sm:col-span-2 sm:mt-0 flex-1 mt-1 text-lg text-white",children:x})]}),a("div",{className:"flex mb-8",children:[e("p",{className:"text-gray-200/70 flex-1 text-lg font-medium",children:"Email"}),d?a("div",{className:"flex-1",children:[e("input",{placeholder:"Email",autoComplete:"Email",type:"text",className:"input-text",value:p,onChange:t=>P(t.target.value)}),a("div",{className:"flex gap-4 pt-4",children:[e("a",{onClick:()=>{y(!1)},className:"secondary-button ml-auto cursor-pointer",children:"Cancel"}),e(N,{type:"submit",onClick:()=>{y(!1),submitEmail()},submitted:b,children:"Submit"})]})]}):e("p",{className:"sm:col-span-2 sm:mt-0 flex-1 mt-1 text-lg text-white",children:p})]}),a("div",{className:"flex mb-8",children:[e("p",{className:"text-gray-200/70 flex-1 text-lg font-medium",children:C?e(i,{children:"Change Password"}):a(i,{children:["Password",e("a",{onClick:()=>f(!0),className:"text-white/70 pl-2 font-light cursor-pointer",children:"(change)"})]})}),C?a("div",{className:"flex flex-col flex-1 gap-2",children:[I?e("div",{className:"relative px-4 py-3 mt-5 mb-2 text-red-700 bg-red-100 border border-red-600 rounded",role:"alert",children:e("span",{className:"sm:inline block",children:"The password is not correct."})}):e(i,{}),a("form",{className:"flex flex-col gap-2",onSubmit:()=>{event.preventDefault(),z()},children:[e("input",{autoComplete:"email",type:"email",className:"hidden",placeholder:"Email"}),e("input",{autoComplete:"current-password",type:"password",className:"input-text",placeholder:"Old password",value:k,onChange:t=>{E(t.target.value),g(!1)}}),e("input",{autoComplete:"new-password",type:"password",className:"input-text",placeholder:"New password",value:m,onChange:t=>{R(t.target.value),w!==t.target.value?c(!0):c(!1)}}),U?e("div",{className:"relative px-4 py-3 mt-5 mb-2 text-red-700 bg-red-100 border border-red-400 rounded",role:"alert",children:"The passwords do not match"}):e(i,{}),e("input",{autoComplete:"new-password",type:"password",className:"input-text",placeholder:"Confirm new password",value:w,onChange:t=>{L(t.target.value),c(!1),t.target.value!==m?c(!0):c(!1)}}),a("div",{className:"flex gap-4 pt-4",children:[e("a",{onClick:()=>{f(!1),D()},className:"secondary-button ml-auto cursor-pointer",children:"Cancel"}),e(N,{type:"submit",submitted:b,children:"Submit"})]})]})]}):e("p",{className:"sm:col-span-2 sm:mt-0 flex-1 mt-1 text-lg text-white",children:"*********"})]}),a("div",{className:"flex mb-8",children:[a("p",{className:"text-gray-200/70 flex-1 text-lg font-medium",children:["Subscription ",e("a",{onClick:()=>$(!v),className:"text-white/70 pl-2 font-light cursor-pointer",children:"(manage)"})]}),v?e("div",{className:"flex-1",children:h>0?a("a",{className:"rounded-xl bg-black/40 flex flex-col w-full gap-2 px-4 py-2 pb-6 my-2 cursor-pointer",children:[e("h3",{className:"text-xl font-bold",children:"Free trial!"}),a("p",{children:[h.toFixed(0)," days remaining"]}),e("button",{className:"fancy block w-full px-6 py-3 font-medium text-center text-black bg-white border border-transparent rounded-full",onClick:()=>A().then(()=>window.location.href=u.homepageDomain+"/pricing"),children:"Cancel Now"})]}):a("a",{onClick:()=>{W().then(t=>window.location.href=t)},className:"bg-black/40 w-fit flex gap-4 px-4 py-2 my-2 rounded-lg cursor-pointer",children:[a("div",{children:[e("p",{className:"text-lg text-white",children:"Subscription Cost"}),e("p",{className:"text-sm text-gray-400",children:"Open in Stripe"})]}),e("div",{className:"text-right",children:a("p",{className:"text-lg text-green-500",children:["$",F.toFixed(2)]})}),e(Q,{className:"w-12 my-auto text-white"})]})}):e(i,{children:h>0?a("p",{className:"sm:col-span-2 sm:mt-0 flex flex-col flex-1 mt-1 text-lg text-white",children:["Free Trial! ",a("span",{className:"text-md italic text-gray-300",children:[h.toFixed(0)," days remaining"]})]}):a("p",{className:"sm:col-span-2 sm:mt-0 flex-1 mt-1 text-lg",children:["$",F.toFixed(2)]})})]})]}),e("div",{className:"flex flex-col items-center my-auto",children:e("a",{onClick:()=>{s.authStore.clear(),window.location.href="/signin"},className:"warning-button w-3/4 mt-12",children:"Sign Out"})})]})}export{se as default};
