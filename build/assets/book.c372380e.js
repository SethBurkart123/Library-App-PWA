import{R as V,g as ce,c as he,b as F}from"./globalVars.97df2e75.js";import{r as o,j as e,F as g,a as r,b as me}from"./index.5791bf1f.js";import{P as T,C as H,a as A}from"./spine.729886ec.js";import{L as de,a as pe,b as ue}from"./List.29066325.js";import{n as ge}from"./noImage.644fcd52.js";import{L as z}from"./LoaderButton.83bc68f8.js";import xe from"./installPrompt.36576cb2.js";const we=()=>r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"CurrentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-x-circle",children:[e("title",{children:"Remove"}),e("circle",{cx:"12",cy:"12",r:"10"}),e("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),be={border:"none",margin:0,padding:0,width:"auto",overflow:"visible",cursor:"pointer",background:"transparent"},fe=()=>e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-6 h-6",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5"})});function ye(){const c=new V(ce.pocketbaseDomain),[j,d]=o.exports.useState(""),[f,p]=o.exports.useState(""),[y,s]=o.exports.useState(""),[N,v]=o.exports.useState([]),[h,x]=o.exports.useState([]),[P,k]=o.exports.useState(!1),R=async a=>{try{const i=await c.collection("book").getList(1,4,{filter:`name ~ "${a}"`});v(i.items)}catch{}};function u(a){d(a.target.value),R(a.target.value)}function C(a,i){x(m=>[...m,{name:`${a}`,id:`${i}`}])}const S=async()=>{const a={user:c.authStore.model.id,books:h.map(({id:i})=>i),name:f,description:y};k(!0);try{const i=await c.collection("collection").create(a);window.location.href="/"}catch{k(!1)}};return e(g,{children:r("div",{className:"px-4 text-white",children:[e("h2",{className:"py-2 pr-4 text-lg font-light text-white",children:"Collection Name"}),e("input",{maxLength:100,type:"text",className:"input-text w-full px-4 py-2 text-white",value:f,onChange:a=>p(a.target.value)}),r("h2",{className:"py-2 pr-4 text-lg font-light text-white",children:["Description ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),e("textarea",{maxLength:5e3,rows:"18",type:"text",className:"input-text w-full px-4 py-2 text-white",placeholder:"",value:y,onChange:a=>s(a.target.value)}),r("h2",{className:"py-2 pr-4 text-lg font-light text-white",children:["Add Books ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),e("input",{type:"text",value:j,onChange:u,className:"input-text w-full px-4 py-2 text-white",placeholder:"Search"}),N.map((a,i)=>r("div",{className:"input-text flex gap-1 px-2 py-2 my-2",id:i.toString(),children:[e("div",{className:"w-1/3",style:{minHeight:"4rem"},children:a.coverImage?e("img",{className:"max-h-32 rounded-md",src:he(a.id,a.coverImage)}):e("img",{className:"max-h-32 rounded-md",src:ge})}),r("div",{className:"flex flex-col w-full",children:[e("p",{className:" text-xl text-white",children:a.name?r(g,{children:[a.name.substring(0,18),e("span",{className:"bg-gradient-to-r from-white to-white/0 bg-clip-text text-transparent",children:a.name.substring(18,24)})]}):"Untitled"}),e("p",{className:"text-white/80 text-lg",children:a.author?r(g,{children:[a.author.substring(0,18),e("span",{className:"bg-gradient-to-r from-white/80 to-white/0 bg-clip-text text-transparent",children:a.author.substring(18,24)})]}):"No Author"}),e("div",{className:"space-between flex w-full mt-auto mb-0",children:e("button",{onClick:()=>C(a.name,a.id),className:"secondary-button bg-gray-500/20 ml-auto mr-0",children:"Add"})})]})]},i.toString())),e("h2",{className:"pt-2 pr-4 mt-2 text-lg font-light text-white",children:"Preview Books"}),h[0]?null:e("p",{className:"input-text w-full px-4 py-2 my-4 text-lg text-center text-white",children:"There are no books in this collection"}),e(de,{values:h,onChange:({oldIndex:a,newIndex:i})=>x(pe(h,a,i)),renderList:({children:a,props:i,isDragged:m})=>e("ul",{...i,style:{cursor:m?"grabbing":"inherit"},children:a}),renderItem:({value:a,props:i,index:m,isDragged:U,isSelected:O})=>e("li",{...i,style:{...i.style,margin:"0.5em 0em",listStyleType:"none",cursor:U?"grabbing":"grab"},className:"bg-wood-side-dark darker outline-1 outline-white/20 outline inner-shadow-main w-full px-4 py-4 my-2 text-white rounded-lg",children:r("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r("div",{className:"flex gap-4",children:[e(fe,{}),a.name?r("p",{className:"text-lg",children:[a.name.substring(0,17),e("span",{className:"bg-gradient-to-r from-white to-white/0 bg-clip-text text-transparent",children:a.name.substring(17,22)})]}):"No Name"]})," ",e("button",{onClick:()=>{x(typeof m<"u"?ue(h,m):h)},style:be,children:e(we,{})})]})})}),r("div",{className:"flex gap-4 pt-4",children:[e("a",{href:"/",className:"secondary-button ml-auto",children:"Cancel"}),e(z,{onClick:S,submitted:P,children:"Submit"})]})]})})}function je(){const c=new V(F.pocketbaseDomain);c.authStore.isValid||(window.location.href="/signin");const j=async()=>{try{c.authStore.isValid||(window.location.href="/signin");const t=await c.collection("users").getOne(c.authStore.model.id,{});switch(t.createdSubscription||(t.hasSub?window.location.href="/payment-redirect?paymentPlan="+t.subscriptionPlan:window.location.href=F.homepageDomain+"/pricing"),t.subscriptionPlan){case 3:D(13);break;case 2:D(10);break;default:D(6);break}}catch(t){t.toString().toLowerCase().includes("404")&&(c.authStore.clear(),window.location.href="/signin")}};o.exports.useEffect(()=>{j()},[]);const[d,f]=o.exports.useState(),[p,y]=o.exports.useState(),[s,N]=o.exports.useState([]),[v,h]=o.exports.useState(!0),[x,P]=o.exports.useState(),[k,R]=o.exports.useState(),[u,C]=o.exports.useState([]),S=o.exports.useRef(null),a=o.exports.useRef(null),i=o.exports.useRef(null),[m,U]=o.exports.useState(""),[O,_]=o.exports.useState(""),[M,G]=o.exports.useState(""),[E,J]=o.exports.useState("1750-06-01"),[K,Q]=o.exports.useState(""),[w,L]=o.exports.useState(""),[X,Y]=o.exports.useState([]),[Z,I]=o.exports.useState(-2),[$,D]=o.exports.useState(6),[ee,W]=o.exports.useState(!1);o.exports.useEffect(()=>{if(d!=null){const t=URL.createObjectURL(d);return P(t),()=>URL.revokeObjectURL(t)}},[d]),o.exports.useEffect(()=>{if(p!=null){const t=URL.createObjectURL(p);return R(t),()=>URL.revokeObjectURL(t)}},[p]),o.exports.useEffect(()=>{if(s.length!=u.length){let t=[];for(let n=0;n<s.length;n++){const l=URL.createObjectURL(s[n]);t.push(l)}C(t)}else if(s[s.length-1]!=null){const t=URL.createObjectURL(s[s.length-1]);return C([...u,t]),()=>URL.revokeObjectURL(t)}},[s]);async function te(){W(!0);const t={name:m,author:O,publisher:M,publishDate:E,description:K,user:c.authStore.model.id,borrowedBy:w},n=new FormData;n.append("spineImage",d),n.append("coverImage",p),s.forEach(l=>{n.append("otherImages",l)}),ae(t,n)}async function ae(t,n){try{const l=await c.collection("book").create(t);await c.collection("book").update(l.id,n),window.location.href="/"}catch{W(!1)}}function ne(t){N([...s.slice(0,t),...s.slice(t+1,s.length)])}const re=t=>{new A(t,{quality:.6,success:n=>{f(n)}})},oe=t=>{new A(t,{quality:.6,success:n=>{y(n)}})};function ie(t){let n=[];for(let l=0;l<t.length;l++){let b=t[l],B=new Promise((le,Ne)=>{new A(b,{quality:.6,success:se=>{le(se)}})});n.push(B)}Promise.all(n).then(l=>{let b=$-s.length;l=l.slice(0,b);let B=0;l.length==0&&(B=1),s.length+l.length+B<=$&&N(s.concat(l))})}const q=async t=>{try{const l=await c.collection("book").getList(1,4,{filter:`borrowedBy ~ "${t}"`});var n=[];l.items.map(b=>{n.push(b.borrowedBy)}),Y([...new Set(n)])}catch{}};return e(me,{overlay:e(xe,{hideInstallPrompt:!0}),topbar:e("div",{className:"flex",children:v?r(g,{children:[e("button",{className:"border-b-white inner-shadow-main bg-black/20 backdrop-blur-md flex-1 w-full h-full px-4 pt-3 pb-2 text-xl font-bold text-center text-white border-b-2",children:"Book"}),e("button",{onClick:()=>{h(!1)},className:"text-white/20 backdrop-blur-md bg-black/50 border-b-white/20 inner-shadow-main flex-1 w-full h-full px-4 pt-3 pb-2 text-xl font-bold text-center border-b-2",children:"Collection"})]}):r(g,{children:[e("button",{onClick:()=>{h(!0)},className:"text-white/20 bg-black/50 backdrop-blur-md border-b-white/20 inner-shadow-main flex-1 w-full h-full px-4 pt-3 pb-2 text-xl font-bold text-center border-b-2",children:"Book"}),e("button",{className:"border-b-white inner-shadow-main bg-black/20 backdrop-blur-md flex-1 w-full h-full px-4 pt-3 pb-2 text-xl font-bold text-center text-white border-b-2",children:"Collection"})]})}),children:e("div",{children:v?r("div",{className:"px-4",children:[e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Book Title"}),e("input",{maxLength:100,type:"text",className:"input-text",value:m,onChange:t=>U(t.target.value)}),r("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:["Book Author ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),e("input",{maxLength:100,className:"input-text",type:"text",value:O,onChange:t=>_(t.target.value)}),r("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:["Book Publisher ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),e("input",{maxLength:100,className:"input-text",type:"text",value:M,onChange:t=>G(t.target.value)}),r("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:["Date Published ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),e("input",{className:"input-text",type:"date",value:E,onChange:t=>J(t.target.value)}),r("h2",{className:"py-2 pr-4 text-lg font-light text-white",children:["Description ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),e("textarea",{maxLength:5e3,rows:"18",type:"text",className:"input-text",onChange:t=>Q(t.target.value)}),r("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:["Book Borrower ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),r("div",{className:"bg-black/40 backdrop-blur-sm px-2 py-2 rounded-lg shadow-inner",children:[r("div",{className:"relative",children:[e("input",{maxLength:128,className:"input-text w-full px-4 py-2 rounded-lg outline-none",type:"text",value:w,onChange:t=>{L(t.target.value),q(t.target.value),I(-2)}}),e("svg",{onClick:()=>{L(""),q(""),I(-2)},xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-8.5 h-8.5 absolute top-1 right-1",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]}),w!=""?e(g,{children:X.map((t,n)=>e("div",{id:n.toString(),children:Z==n?t==w?null:r("div",{className:"backdrop-blur-sm bg-white/5 text-md backdrop-brightness-110 border-white/80 flex w-full gap-1 px-1 py-1 mt-2 text-white border rounded-lg shadow-xl cursor-pointer",onClick:()=>{L(""),I(-2)},children:[e(T,{className:"h-6 pointer-events-none"}),e("p",{className:"my-auto pointer-events-none select-none",children:t})]}):t==w?null:r("div",{id:n.toString(),className:"backdrop-blur-sm bg-white/5 border-white/20 text-md flex w-full gap-1 px-1 py-1 mt-2 text-white border rounded-lg shadow-xl cursor-pointer",onClick:()=>{L(t),I(n)},children:[e(T,{className:"h-6 pointer-events-none"}),e("p",{className:"my-auto pointer-events-none select-none",children:t})]},n.toString())},n.toString()))}):null]}),e("h2",{className:" py-2 pr-4 text-lg font-light text-white",children:"Main Images"}),r("div",{className:"input-text flex gap-2 px-2 py-2 text-white outline-none",children:[r("div",{className:"max-h-fit flex-1",children:[d?e("button",{className:"inner-shadow-main border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white bg-transparent border-2 rounded-lg shadow-inner",onClick:()=>i.current.click(),children:"Set Spine Image"}):e("button",{className:"inner-shadow-main border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white bg-transparent border-2 rounded-lg shadow-inner",onClick:()=>i.current.click(),children:"Set Spine Image"}),e("input",{type:"file",id:"spineImage",className:"hidden",ref:i,accept:"image/jpg, image/jpeg, image/png, image/svg+xml, image/gif, image/webp",onChange:t=>{re(t.target.files[0])}}),d?e("img",{alt:"Spine Image",className:"max-h-60 max-w-full mx-auto my-auto rounded-md",onClick:()=>i.current.click(),src:x}):e("img",{alt:"No Spine Image",className:"opacity-20 max-h-60 max-w-full mx-auto my-auto rounded-md",onClick:()=>i.current.click(),src:H})]}),r("div",{className:"max-h-fit flex-1",children:[a?e("button",{className:"inner-shadow-main bg-white/0 border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white border-2 rounded-lg shadow-inner",onClick:()=>a.current.click(),children:"Set Cover Image"}):e("button",{className:"inner-shadow-main bg-white/0 border-white/20 backdrop-blur-sm backdrop-brightness-150 w-full px-4 py-2 mb-4 text-white border-2 rounded-lg shadow-inner",onClick:()=>a.current.click(),children:"Set Cover Image"}),e("input",{type:"file",id:"coverImage",className:"hidden",ref:a,accept:"image/jpg, image/jpeg, image/png, image/svg+xml, image/gif, image/webp",onChange:t=>{oe(t.target.files[0])}}),p?e("img",{alt:"Cover Image",onClick:()=>a.current.click(),src:k,className:"max-h-60 max-w-full mx-auto my-auto rounded-md"}):e("img",{alt:"No Cover Image",onClick:()=>a.current.click(),className:"opacity-20 max-h-60 max-w-full mx-auto my-auto rounded-md",src:H})]})]}),r("h2",{className:"py-2 pr-4 text-lg font-light text-white",children:["Other Images ",e("span",{className:"italic text-gray-300",children:"(optional)"})]}),r("div",{className:"input-text flex flex-wrap gap-4 px-4 py-2 text-white outline-none",children:[e("img",{alt:"Add another image",className:"image h-32 pointer-events-auto",src:"../images/plus.svg",onClick:()=>S.current.click()}),e("input",{type:"file",className:"hidden",ref:S,accept:"image/jpg, image/jpeg, image/png, image/svg+xml, image/gif, image/webp",name:"file",onChange:t=>{ie(t.target.files)},multiple:!0}),u&&u.map((t,n)=>r("div",{className:"image-div",id:n.toString(),children:[e("img",{className:"max-h-32 image outline outline-white rounded-lg opacity-50",src:t}),e("div",{onClick:()=>ne(n),className:"hidden_img",children:e("svg",{className:"mx-auto my-auto text-xl font-bold text-white",xmlns:"http://www.w3.org/2000/svg",width:"72",height:"72",viewBox:"-6 6 24 24",strokeWidth:"1",stroke:"#000000",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e("path",{stroke:"currentColor",d:"M10 10l4 4m0 -4l-4 4"})})})]},n.toString()))]}),r("div",{className:"flex gap-4 pt-4",children:[e("a",{href:"/",className:"secondary-button ml-auto",children:"Cancel"}),e(z,{submitted:ee,onClick:te,children:"Submit"})]})]}):e(ye,{})})})}export{je as default};
