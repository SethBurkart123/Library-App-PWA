import{r as m,a as D,F as S,d as I,j as T}from"./index.5791bf1f.js";function R(s,n,t){return s=s.slice(),s.splice(t<0?s.length+t:t,0,s.splice(n,1)[0]),s}function E(s,n){return s=s.slice(),s.splice(n,1),s}function u(s){const n=window.getComputedStyle(s);return Math.max(parseInt(n["margin-top"],10),parseInt(n["margin-bottom"],10))+s.getBoundingClientRect().height}function w(s){return s.touches&&s.touches.length||s.changedTouches&&s.changedTouches.length}function a(s,n=0,t=0){if(!!s){if(n===null||t===null){s.style.removeProperty("transform");return}s.style.transform=`translate(${t}px, ${n}px)`}}function d(s,n,t){s&&(s.style.transition=`transform ${n}ms${t?` ${t}`:""}`)}function x(s,n){let t=0,e=s.length-1,i;for(;t<=e;){if(i=Math.floor((e+t)/2),!s[i+1]||s[i]<=n&&s[i+1]>=n)return i;s[i]<n&&s[i+1]<n?t=i+1:e=i-1}return-1}const f=s=>{let n=[],t=null;const e=(...i)=>{n=i,!t&&(t=requestAnimationFrame(()=>{t=null,s(...n)}))};return e.cancel=()=>{t&&cancelAnimationFrame(t)},e};function v(s,n){const t=["input","textarea","select","option","optgroup","video","audio","button","a"],e=["button","link","checkbox","tab"];for(;s!==n;){if(s.getAttribute("data-movable-handle"))return!1;if(t.includes(s.tagName.toLowerCase()))return!0;const i=s.getAttribute("role");if(i&&e.includes(i.toLowerCase())||s.tagName.toLowerCase()==="label"&&s.hasAttribute("for"))return!0;s.tagName&&(s=s.parentElement)}return!1}const l=200,g=10;class O extends m.exports.Component{constructor(n){super(n),this.listRef=m.exports.createRef(),this.ghostRef=m.exports.createRef(),this.topOffsets=[],this.itemTranslateOffsets=[],this.initialYOffset=0,this.lastScroll=0,this.lastYOffset=0,this.lastListYOffset=0,this.needle=-1,this.afterIndex=-2,this.state={itemDragged:-1,itemDraggedOutOfBounds:-1,selectedItem:-1,initialX:0,initialY:0,targetX:0,targetY:0,targetHeight:0,targetWidth:0,liveText:"",scrollingSpeed:0,scrollWindow:!1},this.doScrolling=()=>{const{scrollingSpeed:t,scrollWindow:e}=this.state,i=this.listRef.current;window.requestAnimationFrame(()=>{e?window.scrollTo(window.pageXOffset,window.pageYOffset+t*1.5):i.scrollTop+=t,t!==0&&this.doScrolling()})},this.getChildren=()=>this.listRef&&this.listRef.current?Array.from(this.listRef.current.children):(console.warn("No items found in the List container. Did you forget to pass & spread the `props` param in renderList?"),[]),this.calculateOffsets=()=>{this.topOffsets=this.getChildren().map(t=>t.getBoundingClientRect().top),this.itemTranslateOffsets=this.getChildren().map(t=>u(t))},this.getTargetIndex=t=>this.getChildren().findIndex(e=>e===t.target||e.contains(t.target)),this.onMouseOrTouchStart=t=>{this.dropTimeout&&this.state.itemDragged>-1&&(window.clearTimeout(this.dropTimeout),this.finishDrop());const e=w(t);if(!e&&t.button!==0)return;const i=this.getTargetIndex(t);if(i===-1||this.props.values[i]&&this.props.values[i].disabled){this.state.selectedItem!==-1&&(this.setState({selectedItem:-1}),this.finishDrop());return}const o=this.getChildren()[i],r=o.querySelector("[data-movable-handle]");if(!(r&&!r.contains(t.target))&&!v(t.target,o)){if(t.preventDefault(),this.props.beforeDrag&&this.props.beforeDrag({elements:this.getChildren(),index:i}),e){const h={passive:!1};o.style.touchAction="none",document.addEventListener("touchend",this.schdOnEnd,h),document.addEventListener("touchmove",this.schdOnTouchMove,h),document.addEventListener("touchcancel",this.schdOnEnd,h)}else{document.addEventListener("mousemove",this.schdOnMouseMove),document.addEventListener("mouseup",this.schdOnEnd);const h=this.getChildren()[this.state.itemDragged];h&&h.style&&(h.style.touchAction="")}this.onStart(o,e?t.touches[0].clientX:t.clientX,e?t.touches[0].clientY:t.clientY,i)}},this.getYOffset=()=>{const t=this.listRef.current?this.listRef.current.scrollTop:0;return window.pageYOffset+t},this.onStart=(t,e,i,o)=>{this.state.selectedItem>-1&&(this.setState({selectedItem:-1}),this.needle=-1);const r=t.getBoundingClientRect(),h=window.getComputedStyle(t);this.calculateOffsets(),this.initialYOffset=this.getYOffset(),this.lastYOffset=window.pageYOffset,this.lastListYOffset=this.listRef.current.scrollTop,this.setState({itemDragged:o,targetX:r.left-parseInt(h["margin-left"],10),targetY:r.top-parseInt(h["margin-top"],10),targetHeight:r.height,targetWidth:r.width,initialX:e,initialY:i})},this.onMouseMove=t=>{t.cancelable&&t.preventDefault(),this.onMove(t.clientX,t.clientY)},this.onTouchMove=t=>{t.cancelable&&t.preventDefault(),this.onMove(t.touches[0].clientX,t.touches[0].clientY)},this.onWheel=t=>{this.state.itemDragged<0||(this.lastScroll=this.listRef.current.scrollTop+=t.deltaY,this.moveOtherItems())},this.onMove=(t,e)=>{if(this.state.itemDragged===-1)return null;a(this.ghostRef.current,e-this.state.initialY,this.props.lockVertically?0:t-this.state.initialX),this.autoScrolling(e),this.moveOtherItems()},this.moveOtherItems=()=>{const t=this.ghostRef.current.getBoundingClientRect(),e=t.top+t.height/2,i=u(this.getChildren()[this.state.itemDragged]),o=this.getYOffset();this.initialYOffset!==o&&(this.topOffsets=this.topOffsets.map(r=>r-(o-this.initialYOffset)),this.initialYOffset=o),this.isDraggedItemOutOfBounds()&&this.props.removableByMove?this.afterIndex=this.topOffsets.length+1:this.afterIndex=x(this.topOffsets,e),this.animateItems(this.afterIndex===-1?0:this.afterIndex,this.state.itemDragged,i)},this.autoScrolling=t=>{const{top:e,bottom:i,height:o}=this.listRef.current.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight;if(i>r&&r-t<l)this.setState({scrollingSpeed:Math.round((l-(r-t))/g),scrollWindow:!0});else if(e<0&&t<l)this.setState({scrollingSpeed:Math.round((l-t)/-g),scrollWindow:!0});else if(this.state.scrollWindow&&this.state.scrollingSpeed!==0&&this.setState({scrollingSpeed:0,scrollWindow:!1}),o+20<this.listRef.current.scrollHeight){let h=0;t-e<l?h=Math.round((l-(t-e))/-g):i-t<l&&(h=Math.round((l-(i-t))/g)),this.state.scrollingSpeed!==h&&this.setState({scrollingSpeed:h})}},this.animateItems=(t,e,i,o=!1)=>{this.getChildren().forEach((r,h)=>{if(d(r,this.props.transitionDuration),e===h&&o){if(e===t)return a(r,null);a(r,e<t?this.itemTranslateOffsets.slice(e+1,t+1).reduce((c,p)=>c+p,0):this.itemTranslateOffsets.slice(t,e).reduce((c,p)=>c+p,0)*-1)}else e<t&&h>e&&h<=t?a(r,-i):h<e&&e>t&&h>=t?a(r,i):a(r,null)})},this.isDraggedItemOutOfBounds=()=>{const t=this.getChildren()[this.state.itemDragged].getBoundingClientRect(),e=this.ghostRef.current.getBoundingClientRect();return Math.abs(t.left-e.left)>e.width?(this.state.itemDraggedOutOfBounds===-1&&this.setState({itemDraggedOutOfBounds:this.state.itemDragged}),!0):(this.state.itemDraggedOutOfBounds>-1&&this.setState({itemDraggedOutOfBounds:-1}),!1)},this.onEnd=t=>{t.cancelable&&t.preventDefault(),document.removeEventListener("mousemove",this.schdOnMouseMove),document.removeEventListener("touchmove",this.schdOnTouchMove),document.removeEventListener("mouseup",this.schdOnEnd),document.removeEventListener("touchup",this.schdOnEnd),document.removeEventListener("touchcancel",this.schdOnEnd);const e=this.props.removableByMove&&this.isDraggedItemOutOfBounds();!e&&this.props.transitionDuration>0&&this.afterIndex!==-2&&f(()=>{d(this.ghostRef.current,this.props.transitionDuration,"cubic-bezier(.2,1,.1,1)"),this.afterIndex<1&&this.state.itemDragged===0?a(this.ghostRef.current,0,0):a(this.ghostRef.current,-(window.pageYOffset-this.lastYOffset)+-(this.listRef.current.scrollTop-this.lastListYOffset)+(this.state.itemDragged<this.afterIndex?this.itemTranslateOffsets.slice(this.state.itemDragged+1,this.afterIndex+1).reduce((i,o)=>i+o,0):this.itemTranslateOffsets.slice(this.afterIndex<0?0:this.afterIndex,this.state.itemDragged).reduce((i,o)=>i+o,0)*-1),0)})(),this.dropTimeout=window.setTimeout(this.finishDrop,e||this.afterIndex===-2?0:this.props.transitionDuration)},this.finishDrop=()=>{const t=this.props.removableByMove&&this.isDraggedItemOutOfBounds();(t||this.afterIndex>-2&&this.state.itemDragged!==this.afterIndex)&&this.props.onChange({oldIndex:this.state.itemDragged,newIndex:t?-1:Math.max(this.afterIndex,0),targetRect:this.ghostRef.current.getBoundingClientRect()}),this.getChildren().forEach(e=>{d(e,0),a(e,null),e.style.touchAction=""}),this.setState({itemDragged:-1,scrollingSpeed:0}),this.afterIndex=-2,this.lastScroll>0&&(this.listRef.current.scrollTop=this.lastScroll,this.lastScroll=0)},this.onKeyDown=t=>{const e=this.state.selectedItem,i=this.getTargetIndex(t);if(!v(t.target,t.currentTarget)&&i!==-1){if(t.key===" "&&(t.preventDefault(),e===i?(e!==this.needle&&(this.getChildren().forEach(o=>{d(o,0),a(o,null)}),this.props.onChange({oldIndex:e,newIndex:this.needle,targetRect:this.getChildren()[this.needle].getBoundingClientRect()}),this.getChildren()[this.needle].focus()),this.setState({selectedItem:-1,liveText:this.props.voiceover.dropped(e+1,this.needle+1)}),this.needle=-1):(this.setState({selectedItem:i,liveText:this.props.voiceover.lifted(i+1)}),this.needle=i,this.calculateOffsets())),(t.key==="ArrowDown"||t.key==="j")&&e>-1&&this.needle<this.props.values.length-1){t.preventDefault();const o=u(this.getChildren()[e]);this.needle++,this.animateItems(this.needle,e,o,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!1)})}if((t.key==="ArrowUp"||t.key==="k")&&e>-1&&this.needle>0){t.preventDefault();const o=u(this.getChildren()[e]);this.needle--,this.animateItems(this.needle,e,o,!0),this.setState({liveText:this.props.voiceover.moved(this.needle+1,!0)})}t.key==="Escape"&&e>-1&&(this.getChildren().forEach(o=>{d(o,0),a(o,null)}),this.setState({selectedItem:-1,liveText:this.props.voiceover.canceled(e+1)}),this.needle=-1),(t.key==="Tab"||t.key==="Enter")&&e>-1&&t.preventDefault()}},this.schdOnMouseMove=f(this.onMouseMove),this.schdOnTouchMove=f(this.onTouchMove),this.schdOnEnd=f(this.onEnd)}componentDidMount(){this.calculateOffsets(),document.addEventListener("touchstart",this.onMouseOrTouchStart,{passive:!1,capture:!1}),document.addEventListener("mousedown",this.onMouseOrTouchStart)}componentDidUpdate(n,t){t.scrollingSpeed!==this.state.scrollingSpeed&&t.scrollingSpeed===0&&this.doScrolling()}componentWillUnmount(){document.removeEventListener("touchstart",this.onMouseOrTouchStart),document.removeEventListener("mousedown",this.onMouseOrTouchStart),this.dropTimeout&&window.clearTimeout(this.dropTimeout),this.schdOnMouseMove.cancel(),this.schdOnTouchMove.cancel(),this.schdOnEnd.cancel()}render(){const n={userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",boxSizing:"border-box",position:"relative"},t={...n,top:this.state.targetY,left:this.state.targetX,width:this.state.targetWidth,height:this.state.targetHeight,position:"fixed",marginTop:0};return D(S,{children:[this.props.renderList({children:this.props.values.map((e,i)=>{const o=i===this.state.itemDragged,r=i===this.state.selectedItem,h=this.props.values[i]&&this.props.values[i].disabled,c={key:i,tabIndex:h?-1:0,"aria-roledescription":this.props.voiceover.item(i+1),onKeyDown:this.onKeyDown,style:{...n,visibility:o?"hidden":void 0,zIndex:r?5e3:0}};return this.props.renderItem({value:e,props:c,index:i,isDragged:!1,isSelected:r,isOutOfBounds:!1})}),isDragged:this.state.itemDragged>-1,props:{ref:this.listRef}}),this.state.itemDragged>-1&&I.exports.createPortal(this.props.renderItem({value:this.props.values[this.state.itemDragged],props:{ref:this.ghostRef,style:t,onWheel:this.onWheel},index:this.state.itemDragged,isDragged:!0,isSelected:!1,isOutOfBounds:this.state.itemDraggedOutOfBounds>-1}),this.props.container||document.body),T("div",{"aria-live":"assertive",role:"log","aria-atomic":"true",style:{position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0px",padding:"0px",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)",clipPath:"inset(100%)"},children:this.state.liveText})]})}}O.defaultProps={transitionDuration:300,lockVertically:!1,removableByMove:!1,voiceover:{item:s=>`You are currently at a draggable item at position ${s}. Press space bar to lift.`,lifted:s=>`You have lifted item at position ${s}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,moved:(s,n)=>`You have moved the lifted item ${n?"up":"down"} to position ${s}. Press j to move down, k to move up, space bar to drop and escape to cancel.`,dropped:(s,n)=>`You have dropped the item. It has moved from position ${s} to ${n}.`,canceled:s=>`You have cancelled the movement. The item has returned to its starting position of ${s}.`}};const M=O;export{M as L,R as a,E as b};
