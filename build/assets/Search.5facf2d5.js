import{r,j as e,R as le,F as m,a as n,L as W,b as ce,_ as D}from"./index.5791bf1f.js";import{g as Q,a as X,R as ie}from"./globalVars.97df2e75.js";import{n as Y}from"./noImage.644fcd52.js";function de({setBorrower:h,borrower:o,placeholder:u,className:l,getBooks:p}){return r.exports.useEffect(()=>{p(1)},[o]),e("div",{className:l,children:e("div",{className:"px-2 py-2 shadow-inner bg-black/40 backdrop-blur-sm rounded-2xl",children:e("input",{maxLength:128,placeholder:u,className:"input-text",type:"text",value:o,onChange:i=>{h(i.target.value)}})})})}function ue({setAuthor:h,author:o,placeholder:u,className:l,getBooks:p}){return r.exports.useEffect(()=>{p(1)},[o]),e("div",{className:l,children:e("div",{className:"px-2 py-2 shadow-inner bg-black/40 backdrop-blur-sm rounded-2xl",children:e("input",{maxLength:128,placeholder:u,className:"input-text",type:"text",value:o,onChange:i=>{h(i.target.value)}})})})}const pe=r.exports.lazy(()=>D(()=>import("./installPrompt.36576cb2.js"),["assets/installPrompt.36576cb2.js","assets/index.5791bf1f.js","assets/index.0f403c85.css"])),he=r.exports.lazy(()=>D(()=>import("./Collection.47bd407b.js"),["assets/Collection.47bd407b.js","assets/List.29066325.js","assets/index.5791bf1f.js","assets/index.0f403c85.css","assets/noImage.644fcd52.js","assets/globalVars.97df2e75.js","assets/LoaderButton.83bc68f8.js"])),me=r.exports.lazy(()=>D(()=>import("./Book.6b861053.js"),["assets/Book.6b861053.js","assets/index.5791bf1f.js","assets/index.0f403c85.css","assets/globalVars.97df2e75.js","assets/spine.729886ec.js","assets/noImage.644fcd52.js","assets/LoaderButton.83bc68f8.js"])),c=new ie(Q.pocketbaseDomain),xe=new URLSearchParams(window.location.search),we=le.memo(function(){const o=xe.get("success");r.exports.useEffect(()=>{E.current.scrollIntoView({block:"end"}),u()},[]);const u=async()=>{o=="true"&&await se(5e3),G()},[l,p]=r.exports.useState(""),[i,H]=r.exports.useState(!1),[I,Z]=r.exports.useState(""),[x,C]=r.exports.useState(!1),[P,ee]=r.exports.useState(""),[O,_]=r.exports.useState(1),[V,R]=r.exports.useState(1),[$,j]=r.exports.useState(2),[T,F]=r.exports.useState(2),[L,M]=r.exports.useState([]),[g,q]=r.exports.useState([]),[f,w]=r.exports.useState(!1),[v,A]=r.exports.useState(!1),[te,N]=r.exports.useState({}),[re,U]=r.exports.useState({}),k=r.exports.useRef(null),y=r.exports.useRef(null),S=r.exports.useRef(null),B=r.exports.useRef(null),E=r.exports.useRef(null),se=t=>new Promise(s=>setTimeout(s,t)),G=async()=>{try{c.authStore.isValid||(window.location.href="/signin");const t=await c.collection("users").getOne(c.authStore.model.id,{});t.createdSubscription||(t.hasSub?window.location.href="/payment-redirect?paymentPlan="+t.subscriptionPlan:window.location.href=Q.homepageDomain+"/pricing")}catch(t){t.toString().toLowerCase().includes("404")&&(c.authStore.clear(),window.location.href="/signin")}},K=async t=>{if(t<=T)try{c.cancelRequest("collectionSearch"),c.cancelRequest("collectionSearch");const s=await c.collection("collection").getList(t,7,{filter:`name ~ "${l}"`,expand:"books",$cancelKey:"collectionSearch"});s.totalPages>0&&F(s.totalPages),t==1?(R(1),q(s.items)):q(g.concat(s.items))}catch{}T<=0&&F(1)},b=async t=>{if(t<=$)try{c.cancelRequest("bookSearch");const s=await c.collection("book").getList(t,7,{filter:`name ~ "${l}" && author ~ "${P}" && borrowedBy ~ "${I}" ${x?"&& borrowedBy != null":""}`,$cancelKey:"bookSearch"});s.totalPages>0&&j(s.totalPages),t==1?(_(1),M(s.items)):s.items.length>0&&M(a=>[...a,...s.items])}catch{}$<=0&&j(1)};r.exports.useEffect(()=>{b(1)},[x]),r.exports.useEffect(()=>{b(O)},[O]),r.exports.useEffect(()=>{K(V)},[V]),r.exports.useEffect(()=>{E.current.scrollIntoView({block:"end"}),K(1),b(1)},[l]),r.exports.useEffect(()=>(B.current=new IntersectionObserver(t=>{t.forEach(s=>{s.isIntersecting&&_(a=>a+1)})},{rootMargin:"0px 0px 500px 0px",threshold:0}),_(1),y.current&&B.current.observe(y.current),()=>{B.current&&B.current.disconnect()}),[y,f,v]),r.exports.useEffect(()=>(S.current=new IntersectionObserver(t=>{t.forEach(s=>{s.isIntersecting&&R(a=>a+1)})},{rootMargin:"0px 0px 500px 0px",threshold:0}),R(1),k.current&&S.current.observe(k.current),()=>{S.current&&S.current.disconnect()}),[k,f,v]);const[oe,z]=r.exports.useState(0);function ne(t,s){var a=[];L.map((d,ae)=>{ae===t?a.push(s):a.push(d)}),M(a)}return e(m,{children:f||v?n(m,{children:[f?e(r.exports.Suspense,{fallback:e(W,{}),children:e(me,{backFunction:w,setBookData:N,setCollectionMenu:A,setCollectionData:U,currentIdx:oe,parseBack:ne,data:te})}):null,v&&!f?e(r.exports.Suspense,{fallback:e(W,{}),children:e(he,{backFunction:A,data:re,setBookData:N,setBookMenu:w,setCurrentIdx:z})}):null]}):n(ce,{overlay:e(pe,{hideInstallPrompt:!0}),topbar:n("div",{className:"fully-rounded bg-black/50 px-2 pt-2 transition",style:{boxShadow:"0px 13px 16px -3px rgba(0,0,0,1)"},children:[n("div",{className:"bg-black/20 backdrop-blur-md border-white/20 inner-shadow-main relative flex w-full border-2 rounded-full",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2.5",stroke:"currentColor",className:"top-3 left-3 w-7 h-7 absolute z-10 text-gray-300",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})}),e("input",{value:l,onChange:t=>p(t.target.value),className:"outline-white/20 focus:brightness-110 placeholder-white/60 backdrop-blur-2xl w-full px-3 py-2 pl-12 text-2xl font-medium text-white bg-transparent border-none rounded-full",placeholder:"Search"}),e("div",{onClick:()=>H(!i),className:"text-white/50 top-2 right-2 absolute px-1 rounded-lg cursor-pointer",children:e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-9 h-9",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"})})})]}),e("div",{className:i?"px-6":"hidden",children:n("div",{className:"backdrop-blur-md bg-black/30 inner-shadow-main rounded-b-2xl shadow-strong border-white/20 w-full border-2 border-t-0",style:{boxShadow:"0px 13px 16px -3px rgba(0,0,0,1)"},children:[e("h2",{className:"px-5 py-1 pt-3 text-lg font-light text-gray-500",children:"Borrowed by:"}),e(de,{getBooks:b,className:"px-2",setBorrower:Z,borrower:I,placeholder:""}),e("h2",{className:"px-5 py-1 pt-3 text-lg font-light text-gray-500",children:"Author:"}),e(ue,{getBooks:b,className:"px-2 mb-1",setAuthor:ee,author:P,placeholder:""}),n("div",{onClick:()=>C(!x),className:"flex items-center gap-2 px-4 pt-2 mb-4 cursor-pointer",children:[e("input",{type:"checkbox",className:"pointer-events-nones darker inner-shadow-main p-3 rounded-lg outline-none",id:"borrower-checkbox",name:"borrower-checkbox",onChange:t=>C(t.target.checked),checked:x}),e("label",{className:"py-1 text-lg font-light text-gray-500 align-middle pointer-events-none select-none",children:"Show only borrowed books"})]})]})})]}),children:[g.length!=0?e("div",{className:"mb-16",ref:E}):e("div",{className:"mb-4",ref:E}),P==""&&I==""&&x==!1?g.map((t,s)=>n("div",{onClick:()=>{U(t),A(!0)},className:" flex flex-col -mt-12 cursor-pointer",style:{minHeight:120},id:s.toString(),children:[n("div",{className:"justify-right snap-mandatory snap-x z-10 flex items-baseline gap-4 mb-4 overflow-x-scroll",children:[e("div",{className:"min-w-fit z-50 text-transparent select-none",children:"AGHHHH!!! SAVE ME!!!!!"}),t.expand.books?t.expand.books.map((a,d)=>e("div",{id:d.toString(),className:"snap-center min-w-max z-50",children:a.coverImage?e("img",{id:d.toString(),alt:"Book cover image",className:"z-60 touch shadow-book h-40 my-4 rounded-md cursor-pointer pointer-events-none",src:X(a.id,a.coverImage)},d.toString()):e("img",{id:d.toString(),alt:"No book cover image",className:"z-60 touch shadow-book h-40 my-4 rounded-md cursor-pointer pointer-events-none",src:Y},d.toString())},d.toString())):null,e("div",{className:"min-w-fit z-50 text-transparent select-none",children:"AGHHHH!!! SAVE ME!!!!!"})]}),t.expand.books?e("div",{className:"shelf pl-4 text-xl text-white",children:e("p",{className:"bottom-4 text-shadow left-2 absolute select-none",children:t.name?t.name:"No name"})}):e("div",{className:"shelf mt-36 pl-4 text-xl text-white",children:e("p",{className:"bottom-4 text-shadow left-2 absolute select-none",children:t.name?t.name:"No name"})})]},s.toString())):null,e("div",{ref:k}),e("div",{className:"flex flex-col gap-2",style:g.length!=0?{marginTop:"-0rem"}:{},children:L.map((t,s)=>e("div",{id:s.toString(),children:t.borrowedBy.length==0?e(J,{className:"bg-black/40 backdrop-blur-sm outline-white/10 outline flex gap-1 px-2 py-2 mx-2 rounded-lg cursor-pointer",setBookData:N,book:t,setBookMenu:w,setCurrentIdx:z,idx:s}):e(J,{className:"backdrop-blur-lg bg-black/60 border-white/50 brightness-50 flex gap-1 px-2 py-2 mx-2 border-4 border-double rounded-lg cursor-pointer",setBookData:N,book:t,setBookMenu:w,setCurrentIdx:z,idx:s})},s.toString()))}),L.length>1||g.length>1?null:e("div",{className:""}),e("div",{ref:y})]})})});function J({setBookData:h,book:o,setBookMenu:u,setCurrentIdx:l,idx:p,className:i}){return n("a",{onClick:()=>{h(o),u(!0),l(p)},className:i,children:[e("div",{className:"place-items-center grid w-2/3 select-none",style:{minHeight:"4rem"},children:o.coverImage?e("img",{alt:"Book cover image",className:"max-h-32 rounded-md",src:X(o.id,o.coverImage)}):e("img",{alt:"No book cover image",className:"max-h-32 rounded-md",src:Y})}),n("div",{className:"flex flex-col w-full pl-1 select-none",children:[e("p",{className:" text-xl text-white",children:o.name?n(m,{children:[o.name.substring(0,18),e("span",{className:"bg-gradient-to-r from-white to-white/0 bg-clip-text text-transparent",children:o.name.substring(18,24)})]}):"Untitled"}),e("p",{className:"text-white/80 text-lg",children:o.author?n(m,{children:[o.author.substring(0,18),e("span",{className:"bg-gradient-to-r from-white/80 to-white/0 bg-clip-text text-transparent",children:o.author.substring(18,24)})]}):"No Author"}),e("p",{className:"text-white/60 text-sm",children:o.description?n(m,{children:[o.description.substring(0,90),e("span",{className:"bg-gradient-to-r from-white/60 to-white/0 bg-clip-text text-transparent",children:o.description.substring(90,100)})]}):"No Description"}),e("p",{className:"text-white/80 text-md mt-auto font-medium",children:o.borrowedBy?n(m,{children:["Borrowed By: ",o.borrowedBy.substring(0,90),e("span",{className:"bg-gradient-to-r from-white/60 to-white/0 bg-clip-text text-transparent",children:o.borrowedBy.substring(90,100)})]}):""})]})]})}export{we as default};
